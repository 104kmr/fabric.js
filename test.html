<html>
<header>
  <script src="dist/fabric.js" type="text/javascript" ></script>
  <script src="src/filters/redgreenglitch_filter.class.js" type="text/javascript" ></script>
  <script src="src/filters/colorscale.class.js" type="text/javascript" ></script>

</header>
<body>
  <input type="range" min="-50" max="50" stpe="1" id="offsetX" value="3" />
  <input type="range" min="-50" max="50" stpe="1" id="offsetY" value="3" />
  <label>Use WebGl<input type="checkbox" id="webgl" checked></label>
  <canvas id="canvas" width="500" height="620" ></canvas>
  <script>
    var webglBackend;
    try {
      webglBackend = new fabric.WebglFilterBackend();
    } catch (e) {
      console.log(e)
    }
    var canvas2dBackend = new fabric.Canvas2dFilterBackend();
    // write your test code here
    document.getElementById('webgl').addEventListener('click', function(evt) {
      console.log(evt.target.checked)
      if (evt.target.checked) {
        fabric.filterBackend = webglBackend;
      } else {
        fabric.filterBackend = canvas2dBackend;
      }
    });
    var glitchFilterX = function(evt) {
      glitchFilter.offsetX = parseInt(evt.target.value, 10);
      globalImage.applyFilters();
      canvas.requestRenderAll();
    };
    document.getElementById('offsetX').addEventListener('input', glitchFilterX);
    var glitchFilterY = function(evt) {
      glitchFilter.offsetY = parseInt(evt.target.value, 10);
      globalImage.applyFilters();
      canvas.requestRenderAll();
    };
    document.getElementById('offsetY').addEventListener('input', glitchFilterY);
    var globalImage;
    var glitchFilter = new fabric.Image.filters.RedGreenGlitch({
      offsetX: 1,
      offsetY: 1,
    });
  	var canvas = new fabric.Canvas('canvas');
    fabric.Image.fromURL('http://fabricjs.com/assets/mononoke.jpg', function(image) {
      globalImage = new fabric.Image(image.getElement(), { filters: [glitchFilter] });
      globalImage.scaleToWidth('450')
      canvas.add(globalImage);
    }, { crossOrigin: 'anonymous' });
  </script>
</body>
</html>
