<html>
<header>
  <script src="dist/fabric.js" type="text/javascript" ></script>
  <script src="src/filters/redgreenglitch_filter.class.js" type="text/javascript" ></script>
</header>
<body>
  <input type="range" id="offsetX" value="3" />
  <input type="range" id="offsetY" value="3" />
  <canvas id="canvas" width="500" height="620" ></canvas>
  <script>
    // write your test code here
    var colorHandlerLight = function(evt) {
      duotoneFilter.subFilters[1].color = evt.target.value;
      globalImage.applyFilters();
      canvas.requestRenderAll();
    };
    document.getElementById('offsetX').addEventListener('change', colorHandlerLight);
    var colorHandlerDark = function(evt) {
      duotoneFilter.subFilters[2].color = evt.target.value;
      globalImage.applyFilters();
      canvas.requestRenderAll();
    };
    document.getElementById('offsetY').addEventListener('change', colorHandlerDark);
    var globalImage;
  	var canvas = new fabric.Canvas('canvas');
    var redFilter = new fabric.Image.filters.ColorMatrix({
      matrix: '1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0'.split(' '),
    });
    var greenFilter = new fabric.Image.filters.ColorMatrix({
      matrix: '0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 1 0'.split(' '),
    });
    var blueFilter = new fabric.Image.filters.ColorMatrix({
      matrix: '0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 1 0'.split(' '),
    });
    var glitch1Filter = new fabric.Image.filters.BlendImage({
      mode: 'screen',
    });
    var glitch2Filter = new fabric.Image.filters.BlendImage({
      mode: 'screen',
    });
    var glitchFilter = new fabric.Image.filters.Composed({
      subFilters: [
        glitch1Filter,
        glitch2Filter,
      ]
    });
    fabric.Image.fromURL('https://source.unsplash.com/200x200/?for', function(image) {

      var testImage = new fabric.Image(image.getElement(), { filters: [new fabric.Image.filters.RedGreenGlitch({
        offsetX: 0.01,
        offsetY: 0.01,
      })] });
      canvas.add(testImage);
      var rLayer = new fabric.Image(image.getElement(), { filters: [redFilter] });
      var gLayer = new fabric.Image(image.getElement(), { filters: [greenFilter] });
      var bLayer = new fabric.Image(image.getElement(), { filters: [blueFilter] });

      var greenImage = new fabric.Image(gLayer._element, { top: 2, left: 2 });
      var redImage = new fabric.Image(rLayer._element, { top: -2, left: -2 });
      glitch1Filter.image = greenImage;
      glitch2Filter.image = redImage;
      var baseImage = new fabric.Image(bLayer._element, { filters: [glitchFilter] });

      baseImage.scaleToWidth(480);
      baseImage.applyFilters();
      canvas.add(baseImage);
    }, { crossOrigin: 'anonymous' });
  </script>
</body>
</html>
